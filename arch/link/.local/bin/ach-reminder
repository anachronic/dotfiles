#!/bin/sh

selector() {
    if [ "$XDG_SESSION_TYPE" = "wayland" ]; then
        bemenu -i -p "$1"
    else
        dmenu -i -p "$1"
    fi
}

reminder=$(echo | selector "Remind what? >")
[ "$reminder" = "" ] && exit 1

when=$(echo | selector "When? (at format) >")
[ "$when" = "" ] && exit 1

output=$(echo "dunstify -a reminders Reminder \"$reminder\" -u critical" | at "$when" 2>&1)

if echo "$output" | grep -i garbled > /dev/null; then
    dunstify -a reminders "Reminder failed" "at command reported garbled time"
else
    dunstify -a reminders "Reminders" "Reminder set for $when" -u low
fi
